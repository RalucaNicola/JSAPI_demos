<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>3D MapImageLayer w/ Popups</title>

  <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css" />
  <script>
    var locationPath = location.origin + location.pathname.replace(/\/[^\/]+$/, "");
    window.dojoConfig = {
      packages: [
        {
          name: "lib",
          location: locationPath + "/lib",
        },
      ],
    };
  </script>
  <script src="https://js.arcgis.com/4.24/"></script>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

    #viewDiv canvas {
      filter: saturate(2);
    }
  </style>

  <script>
    require([
      "esri/WebScene",
      "esri/views/SceneView",
      "esri/Graphic",
      "esri/geometry/Point",
      "lib/font",
      "lib/fontmesh"
    ], function (WebScene, SceneView, Graphic, Point, font, fontmesh) {

      const map = new WebScene({
        portalItem: {
          id: "5b013031e2784002855f7508585a0eb6",
        },
      });

      const view = new SceneView({
        container: "viewDiv",
        map: map,
      });

      let graphic = null;

      font
        .create("./assets/Lato-Regular.ttf")
        .then(font => {
          const origin = new Point({
            latitude: -47.0020,
            longitude: -72.052,
            z: 200,
            spatialReference: { wkid: 4326 }
          });
          const text = "P  a  t  a  g  o  n  i  a";

          const mesh = fontmesh.fromString(font, text, origin, { size: 10000, alignment: { x: "center" } });

          function makeGraphic(s) {

            if (graphic) {
              view.graphics.remove(graphic);
            }

            // Rotate so it stands up
            mesh.rotate(0, 0, 70, { origin });

            graphic = new Graphic({
              geometry: mesh,
              symbol: {
                type: "mesh-3d",
                symbolLayers: [
                  {
                    type: "fill",
                    material: { color: "#fcf3e6" }
                  }
                ]
              }
            });

            view.graphics.add(graphic);
          }

          makeGraphic(text);
        })
        .catch(err => {
          console.error(err);
        });
    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>